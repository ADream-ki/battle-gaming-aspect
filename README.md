# PetSkill Aspect

## Instruction

This use case aims to implement a pet eating flow limiter that limits the number of times a pet can acquire skills within a certain period of time to ensure the healthy growth of the pet character and the balance of the game.

## Solution Overview

### Question

Pet characters can acquire new skills by completing quests or meeting certain conditions. Therefore, in order to make the game more interesting, players can make their pets learn different skills by feeding them different foods, so as to increase the challenge and fun of the game.

### Solution

To this end, I designed and implemented a pet skill acquisition restrictor. This restrictor maintains the balance of the game and enhances the player's experience by obtaining the corresponding skills from the type of food after the pet eats and making the pet learn probability.

## Project Design

### Session-key Overview

#### 1. EoA binding session key to Aspect

![截屏2023-11-09 15.37.26.png](https://github.com/QiyuanMa/session-key-aspect-example/blob/main/img/2023-11-09-15.37.26.png)

Additional info:

- `Specific contract` is a contract address. For example, if it’s a DEX contract address, it means that the session key is only limited to calling an Artex contract.

- `Specific methods` is a list of method signature of `Specific contract`. For example, if it’s `[0x0000CAFE, 0xCAFE0000,]` , it means that the session key is only limited to this two method.

#### 2. Use session key to sign transaction

![截屏2023-11-09 15.32.38.png](https://github.com/QiyuanMa/session-key-aspect-example/blob/main/img/2023-11-09-15.32.38.png)

Additional info :

- The `from` is still the address of EoA.

- The signature `v,r,s` is generated by private key of sKey.

#### 3. Artela verify the transaction

![截屏2023-11-09 15.52.20.png](https://github.com/QiyuanMa/session-key-aspect-example/blob/main/img/2023-11-09-15.52.20.png)

Additional info

- The transaction may be signed by the EoA privaten point needs to be verified by the EoA public key again if the Aspect returns key, so the joi false.

#### 4. Call contract

![截屏2023-11-09 15.54.18.png](https://github.com/QiyuanMa/session-key-aspect-example/blob/main/img/2023-11-09-15.54.18.png)

Additional info

- Smart contract doesn’t know which keys sign the tx.

- When the smart contract accesses `msg.sender` , the value is `from` in the transaction.

### Implementation

Session-key Aspect project contains three components:

- **Client**, `sessioin-key-aspect.js`, a client for the dApp front end to use session key.
- **Aspect**, wasm bytecode deployed on Artela
- **Explorer,** extend Artela explorer to show Aspect info

![截屏2023-11-09 16.16.17.png](https://github.com/QiyuanMa/session-key-aspect-example/blob/main/img/2023-11-09-16.16.17.png)

#### What’s the difference between AA

**It works like AA (abstract account).** For example, we can design a kind of AA that can be signed by a main private key and some session keys.

**But it will be more flexible than AA.**

- EoA can not extend to AA.

  If you want to use session-key enable AA, you have to transfer your assets from your EoA to a new AA. This user experience might be terrible in some situations.

  By Session-Key Aspect, an EoA can send a transaction to bind it with Session-Key Aspect, and then the EoA will upgrade to a kind of AA that supports the session key. It needn’t transfer its assets.

- Users only need to manage one key.

  If you use AA, you might manage several AA wallets with different function. By using Aspect to extend EoA, you just use one wallet with several extension functions.

## Value to the Artela Ecosystem

The Session-Key Aspect brings several valuable features to the Artela Ecosystem:

**Enhanced Security:** By allowing EoAs to create session keys for specific transactions, the ecosystem becomes more secure as private keys are not exposed for every interaction.

**Improved Usability:** Users can enjoy a better user experience by managing one wallet with several extension functions, rather than dealing with multiple abstract accounts (AA).

**Flexibility:** EoAs can upgrade to a form of AA that supports session keys without the need to transfer assets, providing flexibility in managing accounts.

**Integration:** The Session-Key Aspect can be integrated into various dApps, enabling on-click trading for DeFi protocols, enhancing UX and wallet security for web applications, and making dApps function like web2 products with simplified login and interaction processes.

For more detailed information, please refer to the project repository.

## How to Use

### Project Intro

- Folder [aspect](https://github.com/QiyuanMa/session-key-aspect-example/blob/main/aspect/README.md) implements the session key Aspect;
- Folder [js_client](https://github.com/QiyuanMa/session-key-aspect-example/blob/main/js_client/session_key_aspect_client/README.md) implements the session key Aspect javascript client.

### Integration

- Bind session key Aspect to you contract by this [guide](https://github.com/QiyuanMa/session-key-aspect-example/blob/main/aspect/README.md)
- Integrate js client to you font-end dApp by this [guide](https://github.com/QiyuanMa/session-key-aspect-example/blob/main/js_client/session_key_aspect_client/README.md)
